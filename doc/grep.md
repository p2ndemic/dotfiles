# Шпаргалка по grep (GNU grep)

## Основной синтаксис

grep [ОПЦИИ] 'ШАБЛОН' [ФАЙЛ...]

* **ШАБЛОН**: Текстовая строка или регулярное выражение, которое вы ищете.
* **ФАЙЛ...**: Один или несколько файлов для поиска. Если файл не указан, `grep` читает стандартный ввод (stdin), что полезно при работе с конвейерами (`|`).

## Часто используемые опции

| Опция         | Длинная опция        | Описание                                                                 |
| :------------ | :------------------- | :----------------------------------------------------------------------- |
| `-i`          | `--ignore-case`      | Игнорировать регистр символов при поиске.                               |
| `-v`          | `--invert-match`     | Инвертировать поиск: показать строки, *не* содержащие шаблон.          |
| `-c`          | `--count`            | Показать только количество строк, содержащих совпадение.                 |
| `-n`          | `--line-number`      | Показать номер строки перед каждой найденной строкой.                     |
| `-l`          | `--files-with-matches` | Показать только имена файлов, содержащих совпадения.                   |
| `-L`          | `--files-without-match`| Показать только имена файлов, *не* содержащих совпадения.             |
| `-r`, `-R`    | `--recursive`        | Рекурсивный поиск: искать в указанной директории и всех поддиректориях. |
| `-w`          | `--word-regexp`      | Искать шаблон как целое слово (окруженное не-словесными символами).      |
| `-E`          | `--extended-regexp`  | Использовать расширенные регулярные выражения (ERE). То же, что `egrep`.   |
| `-F`          | `--fixed-strings`    | Искать фиксированные строки, а не регулярные выражения. Быстрее. То же, что `fgrep`. |
| `-A NUM`      | `--after-context=NUM`| Показать `NUM` строк контекста *после* найденной строки.                |
| `-B NUM`      | `--before-context=NUM`| Показать `NUM` строк контекста *до* найденной строки.                 |
| `-C NUM`      | `--context=NUM`      | Показать `NUM` строк контекста *до и после* найденной строки (`-NUM`).   |
| `--color=auto`|                      | Подсвечивать найденные совпадения цветом (часто включено по умолчанию).  |
| `-o`          | `--only-matching`    | Показывать только совпавшую часть строки, а не всю строку.               |
| `-s`          | `--no-messages`      | Подавлять сообщения об ошибках (например, "файл не найден").             |
| `-x`          | `--line-regexp`      | Искать строки, которые *полностью* совпадают с шаблоном.                 |

## Базовые регулярные выражения (BRE - по умолчанию)

* `.`        : Любой одиночный символ.
* `*`        : Ноль или более повторений предыдущего символа/выражения.
* `^`        : Начало строки.
* `$`        : Конец строки.
* `[]`       : Любой символ из набора (напр., `[abc]`).
* `[^]`      : Любой символ *не* из набора (напр., `[^0-9]`).
* `\`, `\{ \}`, `\( \)`: Специальные символы `*`, `{}`, `()` и др. нужно экранировать `\`, чтобы использовать их как метасимволы (напр., `\(шаблон\)` для группировки).

## Расширенные регулярные выражения (ERE - с опцией `-E`)

Включают всё из BRE, плюс:

* `+`        : Одно или более повторений предыдущего символа/выражения.
* `?`        : Ноль или одно повторение предыдущего символа/выражения.
* `|`        : Логическое ИЛИ (напр., `error|warning`).
* `()`       : Группировка выражений (без `\`).
* `{n,m}`    : От `n` до `m` повторений. `{n,}` - не менее `n`. `{n}` - ровно `n`. (В BRE: `\{n,m\}`)

## Примеры использования

1.  **Найти 'error' в файле `log.txt`:**
    ```bash
    grep 'error' log.txt
    ```

2.  **Найти 'warning' без учета регистра во всех `.log` файлах:**
    ```bash
    grep -i 'warning' *.log
    ```

3.  **Найти все строки, *не* содержащие 'DEBUG', в файле `app.log`:**
    ```bash
    grep -v 'DEBUG' app.log
    ```

4.  **Посчитать количество строк со словом 'connected' в `access.log`:**
    ```bash
    grep -c 'connected' access.log
    ```

5.  **Рекурсивно найти 'TODO' во всех файлах в текущей директории и ниже:**
    ```bash
    grep -r 'TODO' .
    ```

6.  **Найти строки, содержащие 'error' или 'fail', и показать номера строк:**
    ```bash
    grep -n -E 'error|fail' system.log
    # или
    grep -nE 'error|fail' system.log
    ```

7.  **Найти имена всех Python файлов (`.py`), где импортируется `requests`:**
    ```bash
    grep -l 'import requests' *.py
    ```

8.  **Найти процесс 'nginx' в выводе `ps`:**
    ```bash
    ps aux | grep 'nginx'
    ```

9.  **Найти 'exception' и показать 2 строки контекста до и после:**
    ```bash
    grep -C 2 'exception' application.log
    ```

10. **Найти только слово 'user' (не 'username', 'users', etc.):**
    ```bash
    grep -w 'user' data.txt
    ```

## Советы

* **Кавычки:** Всегда заключайте шаблон в кавычки (предпочтительно одинарные `' '`), особенно если он содержит пробелы или специальные символы оболочки (`*`, `$`, `?` и т.д.). Двойные кавычки `"` позволяют интерпретировать переменные оболочки внутри шаблона.
* **Комбинирование опций:** Опции можно комбинировать (напр., `grep -rni 'pattern' dir/`).
* **Производительность:** Для поиска простых строк без метасимволов используйте `-F` (`fgrep`), это может быть быстрее.
