#!/usr/bin/env bash

#  Check for root privileges
if [[ $EUID -ne 0 ]]; then
    echo "This script must be run as root. Please use sudo."
    exit 1
fi

# Function to show usage information
show_usage() {
    echo "Usage: $0 [--performance-powersave | -pp] [--performance-max | -pm] -- <command>"
    echo "  -pp, --performance-powersave  Balanced performance profile"
    echo "  -pm, --performance-max        Maximum performance profile"
}

# Check for minimum required arguments
if [[ $# -lt 2 ]]; then
    show_usage
    exit 1
fi

PROFILE=""
case $1 in
  -pp|--performance-powersave)
    PROFILE="intel-pstate-performance-powersave"
    shift
    ;;
  -pm|--performance-max)
    PROFILE="intel-pstate-performance-max"
    shift
    ;;
  *)
    echo "Invalid profile option. Use -pp or -pm."
    exit 1
    ;;
esac


# Run the application
echo "INFO: Starting application: $@"
exec "$@"

# Restore default profile after application exits
echo "Restoring default profile"
systemctl start intel-pstate-default.service
