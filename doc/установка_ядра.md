Привет! Установка кастомного ядра Linux — это круто для экспериментов, но как новичок, будь осторожен: если что-то пойдёт не так, система может не загрузиться. Рекомендую иметь под рукой live-USB с Arch Linux для восстановления (например, через chroot и reinstall default kernel). Это ядро от Alfred Chen (Project C с оптимизациями планировщика, вроде BMQ/PDS), и оно должно работать на твоём Intel Core i5-1240P (Alder Lake-P, hybrid CPU), но протестируй после установки.

Поскольку ты указал конкретную ветку (linux-6.17.y-prjc-lfbmq), мы соберём ядро вручную из GitLab-репозитория. Это не AUR-пакет (там сейчас версия 6.16), а прямая компиляция. Процесс займёт время (от 30 мин до часов, в зависимости от твоего железа) и потребует ~20-30 ГБ места на диске.

### Шаг 1: Установка зависимостей
Сначала обнови систему и установи необходимые пакеты для компиляции. Открой терминал и выполни:

```
sudo pacman -Syu
sudo pacman -S base-devel git bc cpio gettext libelf pahole perl python rust rust-bindgen rust-src tar xz xmlto inetutils kmod
```

- `base-devel` — базовые инструменты (make, gcc и т.д.).
- Остальное — для kernel build (из Arch Wiki и типичных PKGBUILD).

Если хочешь ускорить (опционально, но рекомендуется для новичка), установи AUR-хелпер вроде `yay` для будущих экспериментов, но здесь он не нужен.

### Шаг 2: Создание директории для сборки
Создай отдельную папку, чтобы не мусорить в home:

```
mkdir ~/kernel-build && cd ~/kernel-build
```

### Шаг 3: Клонирование репозитория и checkout ветки
Склонируй репозиторий и перейди на нужную ветку:

```
git clone https://gitlab.com/alfredchen/linux-prjc.git
cd linux-prjc
git checkout linux-6.17.y-prjc-lfbmq
```

- Если checkout не сработает (ветка не найдена), проверь имя на GitLab — возможно, оно изменилось. На момент моего знания ветка существует.

### Шаг 4: Подготовка конфигурации ядра
Очисти дерево от старых файлов и используй текущую конфигурацию Arch (чтобы сохранить совместимость с твоей системой, включая Wayland и Intel CPU):

```
make mrproper
zcat /proc/config.gz > .config
make olddefconfig
```

- `make mrproper` — очищает.
- `zcat /proc/config.gz > .config` — копирует config из текущего ядра.
- `make olddefconfig` — обновляет config для новой версии, принимая дефолты.

Если хочешь кастомизировать (не обязательно для первого раза):
- Запусти `make menuconfig` (ncurses-интерфейс) или `make nconfig` (улучшенный).
- Ищи опции вроде "Processor type and features" — убедись, что Intel hybrid (big.LITTLE) поддерживается (обычно дефолтно включено).
- Для Project C: опции планировщика (BMQ/PDS) уже в патчах, но проверь в "General setup" > "Preemption Model" или "CPU Scheduler".
- Сохрани и выйди.

**Важно:** В `.config` измени строку `CONFIG_LOCALVERSION=""` на `CONFIG_LOCALVERSION="-prjc-lfbmq"`, чтобы ядро называлось "linux-prjc-lfbmq" и не перезаписывало default. Открой `.config` в редакторе (nano или vim) и найди/измени.

### Шаг 5: Сборка ядра
Скомпилируй ядро и модули. Используй все ядра CPU для скорости (`-j$(nproc)`):

```
make -j$(nproc)
```

- Это займёт время. Если ошибки — проверь логи, возможно,缺少 зависимостей или config-issues.
- Опционально: Чтобы уменьшить размер, используй `modprobed-db` (AUR): установи его, запусти `modprobed-db store`, затем `make LSMOD=~/.config/modprobed.db localmodconfig` перед сборкой.

### Шаг 6: Установка модулей и ядра
Установи собранное:

```
sudo make modules_install
sudo cp arch/x86/boot/bzImage /boot/vmlinuz-linux-prjc-lfbmq
sudo cp System.map /boot/System.map-linux-prjc-lfbmq
```

- `modules_install` — устанавливает модули в /lib/modules/<version>.
- Копируем vmlinuz и System.map в /boot с кастомным именем.

### Шаг 7: Генерация initramfs
Arch использует mkinitcpio для initramfs. Укажи версию ядра (узнай её через `make kernelversion`, плюс твой LOCALVERSION, например, 6.17.0-prjc-lfbmq):

```
sudo mkinitcpio -k 6.17.0-prjc-lfbmq -g /boot/initramfs-linux-prjc-lfbmq.img
```

- Если fallback (резервный) нужен: `sudo mkinitcpio -k 6.17.0-prjc-lfbmq -g /boot/initramfs-linux-prjc-lfbmq-fallback.img -S autodetect`

### Шаг 8: Обновление загрузчика
Зависит от твоего bootloader (в Arch обычно GRUB или systemd-boot).

- **Если GRUB** (проверь `ls /boot/grub`):
  ```
  sudo grub-mkconfig -o /boot/grub/grub.cfg
  ```

- **Если systemd-boot** (проверь `ls /boot/loader`):
  Создай entry вручную: `sudo nano /boot/loader/entries/arch-prjc.conf` с содержимым:
  ```
  title   Arch Linux (prjc-lfbmq)
  linux   /vmlinuz-linux-prjc-lfbmq
  initrd  /initramfs-linux-prjc-lfbmq.img
  options root=PARTUUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx rw  # замени на свой root (узнай через blkid)
  ```
  (Опции — копируй из /boot/loader/entries/arch.conf).

- Если refind или другой — аналогично, добавь entry.

### Шаг 9: Перезагрузка и тестирование
Перезагрузись:

```
sudo reboot
```

В меню загрузчика выбери новое ядро. Если загружается — проверь:

- `uname -r` — должно показать 6.17.x-prjc-lfbmq.
- `lspci -k` / `lsmod` — модули Intel (i915 для GPU, etc.).
- Wayland: если проблемы, fallback на X11 в KDE settings.

Если не загружается: Загрузись в старое ядро, удали файлы /boot/vmlinuz-linux-prjc-lfbmq* и /lib/modules/6.17*, обнови GRUB.

### Дополнительные советы
- **Риски:** Это experimental ядро, может быть нестабильным. Для Intel 12th gen включи `CONFIG_INTEL_PSTATE=y` в config (обычно дефолт).
- **Обновление:** Для апдейтов — pull repo, checkout, rebuild.
- **AUR альтернатива:** Если хочешь проще, установи `linux-prjc` из AUR (yay -S linux-prjc), но оно на 6.16. Для 6.17 — только manual.
- Если ошибки — уточни, что именно, и я помогу.

Удачи! Если что, спрашивай.
