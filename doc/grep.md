# Шпаргалка по grep (GNU grep)

## Основной синтаксис

grep [ОПЦИИ] 'ШАБЛОН' [ФАЙЛ...]

* **ШАБЛОН**: Текстовая строка или регулярное выражение, которое вы ищете.
* **ФАЙЛ...**: Один или несколько файлов для поиска. Если файл не указан, `grep` читает стандартный ввод (stdin), что полезно при работе с конвейерами (`|`).

## Часто используемые опции

| Опция         | Длинная опция        | Описание                                                                 |
| :------------ | :------------------- | :----------------------------------------------------------------------- |
| `-i`          | `--ignore-case`      | Игнорировать регистр символов при поиске.                               |
| `-v`          | `--invert-match`     | Инвертировать поиск: показать строки, *не* содержащие шаблон.          |
| `-c`          | `--count`            | Показать только количество строк, содержащих совпадение.                 |
| `-n`          | `--line-number`      | Показать номер строки перед каждой найденной строкой.                     |
| `-l`          | `--files-with-matches` | Показать только имена файлов, содержащих совпадения.                   |
| `-L`          | `--files-without-match`| Показать только имена файлов, *не* содержащих совпадения.             |
| `-r`, `-R`    | `--recursive`        | Рекурсивный поиск: искать в указанной директории и всех поддиректориях. |
| `-w`          | `--word-regexp`      | Искать шаблон как целое слово (окруженное не-словесными символами).      |
| `-E`          | `--extended-regexp`  | Использовать расширенные регулярные выражения (ERE). То же, что `egrep`.   |
| `-F`          | `--fixed-strings`    | Искать фиксированные строки, а не регулярные выражения. Быстрее. То же, что `fgrep`. |
| `-A NUM`      | `--after-context=NUM`| Показать `NUM` строк контекста *после* найденной строки.                |
| `-B NUM`      | `--before-context=NUM`| Показать `NUM` строк контекста *до* найденной строки.                 |
| `-C NUM`      | `--context=NUM`      | Показать `NUM` строк контекста *до и после* найденной строки (`-NUM`).   |
| `--color=auto`|                      | Подсвечивать найденные совпадения цветом (часто включено по умолчанию).  |
| `-o`          | `--only-matching`    | Показывать только совпавшую часть строки, а не всю строку.               |
| `-s`          | `--no-messages`      | Подавлять сообщения об ошибках (например, "файл не найден").             |
| `-x`          | `--line-regexp`      | Искать строки, которые *полностью* совпадают с шаблоном.                 |

## Базовые регулярные выражения (BRE - по умолчанию)

* `.`        : Любой одиночный символ.
* `*`        : Ноль или более повторений предыдущего символа/выражения.
* `^`        : Начало строки.
* `$`        : Конец строки.
* `[]`       : Любой символ из набора (напр., `[abc]`).
* `[^]`      : Любой символ *не* из набора (напр., `[^0-9]`).
* `\`, `\{ \}`, `\( \)`: Специальные символы `*`, `{}`, `()` и др. нужно экранировать `\`, чтобы использовать их как метасимволы (напр., `\(шаблон\)` для группировки).

## Расширенные регулярные выражения (ERE - с опцией `-E`)

Включают всё из BRE, плюс:

* `+`        : Одно или более повторений предыдущего символа/выражения.
* `?`        : Ноль или одно повторение предыдущего символа/выражения.
* `|`        : Логическое ИЛИ (напр., `error|warning`).
* `()`       : Группировка выражений (без `\`).
* `{n,m}`    : От `n` до `m` повторений. `{n,}` - не менее `n`. `{n}` - ровно `n`. (В BRE: `\{n,m\}`)

## Примеры использования

1.  **Найти 'error' в файле `log.txt`:**
    ```bash
    grep 'error' log.txt
    ```

2.  **Найти 'warning' без учета регистра во всех `.log` файлах:**
    ```bash
    grep -i 'warning' *.log
    ```

3.  **Найти все строки, *не* содержащие 'DEBUG', в файле `app.log`:**
    ```bash
    grep -v 'DEBUG' app.log
    ```

4.  **Посчитать количество строк со словом 'connected' в `access.log`:**
    ```bash
    grep -c 'connected' access.log
    ```

5.  **Рекурсивно найти 'TODO' во всех файлах в текущей директории и ниже:**
    ```bash
    grep -r 'TODO' .
    ```

6.  **Найти строки, содержащие 'error' или 'fail', и показать номера строк:**
    ```bash
    grep -n -E 'error|fail' system.log
    # или
    grep -nE 'error|fail' system.log
    ```

7.  **Найти имена всех Python файлов (`.py`), где импортируется `requests`:**
    ```bash
    grep -l 'import requests' *.py
    ```

8.  **Найти процесс 'nginx' в выводе `ps`:**
    ```bash
    ps aux | grep 'nginx'
    ```

9.  **Найти 'exception' и показать 2 строки контекста до и после:**
    ```bash
    grep -C 2 'exception' application.log
    ```

10. **Найти только слово 'user' (не 'username', 'users', etc.):**
    ```bash
    grep -w 'user' data.txt
    ```

## Советы

* **Кавычки:** Всегда заключайте шаблон в кавычки (предпочтительно одинарные `' '`), особенно если он содержит пробелы или специальные символы оболочки (`*`, `$`, `?` и т.д.). Двойные кавычки `"` позволяют интерпретировать переменные оболочки внутри шаблона.
* **Комбинирование опций:** Опции можно комбинировать (напр., `grep -rni 'pattern' dir/`).
* **Производительность:** Для поиска простых строк без метасимволов используйте `-F` (`fgrep`), это может быть быстрее.

#######################################################################################################################

### Примеры:

#### Основные опции:
- **`-i`** – игнорировать регистр  
  ```bash
  grep -i "hello" file.txt  # Найти "hello", "Hello", "HELLO" и т.д.
  ```

- **`-v`** – инвертировать поиск (показать строки, которые НЕ содержат шаблон)  
  ```bash
  grep -v "error" log.txt  # Все строки, кроме содержащих "error"
  ```

- **`-r`** (или `-R`) – рекурсивный поиск в директориях  
  ```bash
  grep -r "function" /path/to/code/  # Поиск в файлах внутри папки
  ```

- **`-l`** – показать только имена файлов, где есть совпадение  
  ```bash
  grep -l "TODO" *.py  # Вывести названия .py-файлов, содержащих "TODO"
  ```

- **`-n`** – показать номер строки  
  ```bash
  grep -n "warning" server.log  # Найти "warning" и указать номера строк
  ```

- **`-c`** – количество совпадений в файле  
  ```bash
  grep -c "404" access.log  # Сколько раз встречается "404"
  ```

- **`-A`, `-B`, `-C`** – показать строки до/после совпадения:  
  ```bash
  grep -A 3 "Exception" error.log  # 3 строки после каждого "Exception"
  grep -B 2 "start" config.ini    # 2 строки до каждого "start"
  grep -C 1 "match" data.txt      # По 1 строке до и после "match"
  ```

- **`-w`** – искать целые слова (word-boundary)  
  ```bash
  grep -w "var" script.js  # Найдет "var", но не "variable"
  ```

- **`-e`** – несколько шаблонов (ИЛИ)  
  ```bash
  grep -e "error" -e "fail" system.log  # Найти "error" или "fail"
  ```

- **`-f`** – загрузить шаблоны из файла  
  ```bash
  grep -f patterns.txt file.txt  # Искать все строки из patterns.txt
  ```

- **`--color=auto`** – подсветка совпадений  
  ```bash
  grep --color=auto "key" config.json
  ```

#### Регулярные выражения:
- **`.`** – любой символ  
  ```bash
  grep "f.x" file.txt  # Найдет "fox", "fix", "fax"
  ```

- **`^`** – начало строки  
  ```bash
  grep "^start" text.txt  # Строки, начинающиеся с "start"
  ```

- **`$`** – конец строки  
  ```bash
  grep "end$" text.txt  # Строки, заканчивающиеся на "end"
  ```

- **`*`** – повторение 0 или более раз  
  ```bash
  grep "go*d" file.txt  # Найдет "gd", "god", "good", "gooood"
  ```

- **`[]`** – любой символ из набора  
  ```bash
  grep "[aeiou]" words.txt  # Строки, содержащие гласные
  ```

- **`[^]`** – любой символ, кроме указанных  
  ```bash
  grep "[^0-9]" data.txt  # Строки с НЕ-цифрами
  ```

- **`\`** – экранирование спецсимволов  
  ```bash
  grep "price\.php" urls.txt  # Точка ищется как символ, а не как "любой символ"
  ```

#### Полезные комбинации:
1. Поиск в архиве (без распаковки):  
   ```bash
   zgrep "error" /var/log/syslog.1.gz
   ```

2. Поиск с подсчетом (сколько строк совпало):  
   ```bash
   grep -c "GET" access.log
   ```

3. Поиск IP-адресов:  
   ```bash
   grep -Eo "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}" log.txt
   ```

4. Поиск email-адресов:  
   ```bash
   grep -Eo "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" contacts.txt
   ```

5. Игнорировать бинарные файлы:  
   ```bash
   grep -I "text" *
   ```

6. Поиск с контекстом (удобно для логов):  
   ```bash
   grep -C 3 "Critical error" application.log
   ```

> **Примечание:** Для сложных регулярных выражений используйте `grep -E` (или `egrep`), чтобы включить расширенный синтаксис.

### Продвинутые примеры с `grep -E` (расширенные регулярные выражения)

#### 1. **Логин и пароль в конфигах**  
Поиск строк вида `login=value` или `password=value` (регистронезависимо):  
```bash
grep -Ei '(login|password|user|passwd)=[^ ]+' config.ini
```
- `-E` – включает расширенные regex.  
- `(...|...)` – логическое **ИЛИ**.  
- `[^ ]+` – любые символы, кроме пробела.  

---

#### 2. **Поиск валидных email-адресов**  
```bash
grep -Eo '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}' emails.txt
```
- `-o` – только совпавшая часть.  
- `{2,}` – 2 и более символа (для домена `.com`, `.io` и т.д.).  

---

#### 3. **Поиск IPv4-адресов**  
```bash
grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}' access.log
```
- `{3}` – повторение группы `[0-9]{1,3}\.` ровно 3 раза.  

---

#### 4. **Поиск MAC-адресов**  
```bash
grep -Eo '([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}' network.log
```
- `[0-9A-Fa-f]` – hex-символы.  
- `(...){5}` – 5 повторений `XX:` + 2 финальных символа.  

---

#### 5. **Поиск SHA-1 хешей**  
```bash
grep -Eo '[0-9a-f]{40}' hashes.txt
```
- `[0-9a-f]` – hex-символы в нижнем регистре.  

---

#### 6. **Поиск дат в формате `YYYY-MM-DD`**  
```bash
grep -Eo '[0-9]{4}-[0-9]{2}-[0-9]{2}' dates.txt
```
- Альтернатива с проверкой месяцев/дней:  
  ```bash
  grep -Eo '[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])' dates.txt
  ```

---

#### 7. **Поиск HTML-тегов**  
```bash
grep -Eo '<[^>]+>' index.html
```
- `[^>]+` – любые символы, кроме `>`.  

---

#### 8. **Поиск всех `printf`-подобных вызовов в коде**  
```bash
grep -Ern '(printf|sprintf|fprintf)\([^)]*\)' /path/to/code/
```
- `\(...\)` – экранированные скобки для поиска вызовов функций.  

---

#### 9. **Поиск дублирующихся слов**  
```bash
grep -Eow '(\b\w+\b) \1' text.txt
```
- `\b` – граница слова.  
- `\1` – обратная ссылка на первое совпадение (`(\w+)`).  

---

#### 10. **Поиск строк, где есть и `error`, и `critical`**  
```bash
grep -Ei 'error.*critical|critical.*error' app.log
```
- `.*` – любые символы между словами.  

---

#### 11. **Поиск номеров кредитных карт (упрощенно)**  
```bash
grep -Eo '[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}' data.txt
```
- `[- ]?` – необязательный разделитель (`-` или пробел).  

---

#### 12. **Поиск всех `TODO`/`FIXME` в коде**  
```bash
grep -Ern 'TODO|FIXME' /path/to/project/
```
- `-r` – рекурсивно, `-n` – номера строк.  

---

#### 13. **Поиск чисел с плавающей точкой**  
```bash
grep -Eo '[+-]?[0-9]+\.[0-9]+' scientific_data.txt
```
- `[+-]?` – необязательный знак.  

---

#### 14. **Поиск `import` или `require` в JavaScript/Python**  
```bash
grep -E '^(import|require)[ (]' *.js *.py
```
- `^` – начало строки.  

---

#### 15. **Фильтрация логов по временному диапазону**  
```bash
grep -E '2023-01-1[0-5]' server.log
```
- Находит записи с 10 по 15 января 2023.  

---

### Важно:
- Для сложных regex используйте **`-P`** (PCRE, если поддерживается):  
  ```bash
  grep -P '\d{3}-\d{2}-\d{4}' data.txt  # Поиск SSN (XXX-XX-XXXX)
  ```
- В macOS вместо `-P` часто работает **`-E`** или **`perl -nle`**.  

**Доп. опция:** `--include`/`--exclude` – фильтрация файлов:  
```bash
grep -Ern 'function' --include='*.js' --exclude='*.min.js' src/
```
