#!/bin/env bash
# =============================================
# Script to set the Battery charge threshold
# =============================================
# → Installation: 
# → Create a file: sudo nano ~/.local/bin/battery-threshold
# → Make the script executable: sudo chmod +x ~/.local/bin/battery-threshold
# =============================================
# → Create systemd daemon:
# sudo nano /etc/systemd/system/battery-threshold-tuning.service
# → See: https://github.com/p2ndemic/dotfiles/blob/main/etc/systemd/system/battery-threshold-tuning.service
# =============================================
# → Reload systemd and enable/start the 'battery-threshold-tuning.service' immediately:
# sudo systemctl daemon-reload
# sudo systemctl enable --now battery-threshold-tuning.service
# =============================================
# На KDE Plasma 6.3.2+ есть проблема со сбросом значения ограничения уровня заряда батареи [Charge Limit threshold] выставленного в настройках управления питанием.
# После перезагрузки значение постоянно сбрасывается до стандартного значения = 100%.
# Этот фикс призван временно устранить проблему до выхода официального патча KDE.
# =============================================
# Ref: https://bugs.kde.org/show_bug.cgi?id=450551
# Ref: https://invent.kde.org/plasma/powerdevil/-/issues/36
# Ref: https://gitlab.freedesktop.org/upower/upower/-/merge_requests/208
# =============================================
echo 80 | tee /sys/class/power_supply/BAT0/charge_control_end_threshold
